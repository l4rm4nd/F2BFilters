[INCLUDES]

[Definition]

# choose from the below examples based on your traefik log format (JSON vs CLM)
# -----------------------------------------------------------------------------

# fail regex based on traefik JSON access logs with enabled user agent logging
failregex = ^{"ClientAddr":"<F-CLIENTADDR>.*</F-CLIENTADDR>","ClientHost":"<HOST>","ClientPort":"<F-CLIENTPORT>.*</F-CLIENTPORT>","ClientUsername":"<F-CLIENTUSERNAME>.*</F-CLIENTUSERNAME>","DownstreamContentSize":<F-DOWNSTREAMCONTENTSIZE>.*</F-DOWNSTREAMCONTENTSIZE>,"DownstreamStatus":<F-DOWNSTREAMSTATUS>.*</F-DOWNSTREAMSTATUS>,"Duration":<F-DURATION>.*</F-DURATION>,"OriginContentSize":<F-ORIGINCONTENTSIZE>.*</F-ORIGINCONTENTSIZE>,"OriginDuration":<F-ORIGINDURATION>.*</F-ORIGINDURATION>,"OriginStatus":(405|404|403|401|\-),"Overhead":<F-OVERHEAD>.*</F-OVERHEAD>,"RequestAddr":"<F-REQUESTADDR>.*</F-REQUESTADDR>","RequestContentSize":<F-REQUESTCONTENTSIZE>.*</F-REQUESTCONTENTSIZE>,"RequestCount":<F-REQUESTCOUNT>.*</F-REQUESTCOUNT>,"RequestHost":"<F-CONTAINER>.*</F-CONTAINER>","RequestMethod":"<F-REQUESTMETHOD>.*</F-REQUESTMETHOD>","RequestPath":"<F-REQUESTPATH>.*</F-REQUESTPATH>","RequestPort":"<F-REQUESTPORT>.*</F-REQUESTPORT>","RequestProtocol":"<F-REQUESTPROTOCOL>.*</F-REQUESTPROTOCOL>","RequestScheme":"<F-REQUESTSCHEME>.*</F-REQUESTSCHEME>","RetryAttempts":<F-RETRYATTEMPTS>.*</F-RETRYATTEMPTS>,.*"StartLocal":"<F-STARTLOCAL>.*</F-STARTLOCAL>","StartUTC":"<F-STARTUTC>.*</F-STARTUTC>","TLSCipher":"<F-TLSCIPHER>.*</F-TLSCIPHER>","TLSVersion":"<F-TLSVERSION>.*</F-TLSVERSION>","entryPointName":"<F-ENTRYPOINTNAME>.*</F-ENTRYPOINTNAME>","level":"<F-LEVEL>.*</F-LEVEL>","msg":"<F-MSG>.*</F-MSG>",".*":"<F-USERAGENT>.*</F-USERAGENT>","time":"<F-TIME>.*</F-TIME>"}$

# ignore common errors like missing media files or JS/CSS/TXT/ICO stuff for traefik JSON access logs
ignoreregex = ^{"ClientAddr":"<F-CLIENTADDR>.*</F-CLIENTADDR>","ClientHost":"<HOST>","ClientPort":"<F-CLIENTPORT>.*</F-CLIENTPORT>","ClientUsername":"<F-CLIENTUSERNAME>.*</F-CLIENTUSERNAME>","DownstreamContentSize":<F-DOWNSTREAMCONTENTSIZE>.*</F-DOWNSTREAMCONTENTSIZE>,"DownstreamStatus":<F-DOWNSTREAMSTATUS>.*</F-DOWNSTREAMSTATUS>,"Duration":<F-DURATION>.*</F-DURATION>,"OriginContentSize":<F-ORIGINCONTENTSIZE>.*</F-ORIGINCONTENTSIZE>,"OriginDuration":<F-ORIGINDURATION>.*</F-ORIGINDURATION>,"OriginStatus":(405|404|403|401|\-),"Overhead":<F-OVERHEAD>.*</F-OVERHEAD>,"RequestAddr":"<F-REQUESTADDR>.*</F-REQUESTADDR>","RequestContentSize":<F-REQUESTCONTENTSIZE>.*</F-REQUESTCONTENTSIZE>,"RequestCount":<F-REQUESTCOUNT>.*</F-REQUESTCOUNT>,"RequestHost":"<F-REQUESTHOST>.*</F-REQUESTHOST>","RequestMethod":"<F-REQUESTMETHOD>.*</F-REQUESTMETHOD>","RequestPath":"<F-REQUESTPATH>.*(\.png|\.txt|\.jpg|\.ico|\.js|\.css)(/)*?</F-REQUESTPATH>","RequestPort":"<F-REQUESTPORT>.*</F-REQUESTPORT>","RequestProtocol":"<F-REQUESTPROTOCOL>.*</F-REQUESTPROTOCOL>","RequestScheme":"<F-REQUESTSCHEME>.*</F-REQUESTSCHEME>","RetryAttempts":<F-RETRYATTEMPTS>.*</F-RETRYATTEMPTS>,"RouterName":"<F-ROUTERNAME>.*</F-ROUTERNAME>","ServiceAddr":"<F-SERVICEADDR>.*</F-SERVICEADDR>","ServiceName":"<F-SERVICENAME>.*</F-SERVICENAME>","ServiceURL":{<F-SERVICEURL>.*</F-SERVICEURL>},"StartLocal":"<F-STARTLOCAL>.*</F-STARTLOCAL>","StartUTC":"<F-STARTUTC>.*</F-STARTUTC>","TLSCipher":"<F-TLSCIPHER>.*</F-TLSCIPHER>","TLSVersion":"<F-TLSVERSION>.*</F-TLSVERSION>","entryPointName":"<F-ENTRYPOINTNAME>.*</F-ENTRYPOINTNAME>","level":"<F-LEVEL>.*</F-LEVEL>","msg":"<F-MSG>.*</F-MSG>",".*":"<F-USERAGENT>.*</F-USERAGENT>","time":"<F-TIME>.*</F-TIME>"}$

# custom date pattern for traefik JSON access logs
# based on https://github.com/fail2ban/fail2ban/issues/2558#issuecomment-546738270
datepattern = "StartLocal"\s*:\s*"%%Y-%%m-%%d[T]%%H:%%M:%%S\.%%f\d*(%%z)?",

# fail regex based on traefik CLF access.logs with enabled user agent logging
#failregex = ^<HOST> - <F-CLIENTUSERNAME>.*</F-CLIENTUSERNAME> \[<F-TIMESTAMP>.*</F-TIMESTAMP>\] "<F-METHOD>.*</F-METHOD> <F-PATH>.*</F-PATH> <F-PROTOCOL>.*</F-PROTOCOL>" <F-ORIGINHTTPSTATUS>(405|404|403|401|\-)</F-ORIGINHTTPSTATUS> <F-ORIGINCONTENTSIZE>\d+</F-ORIGINCONTENTSIZE> "<F-REFERRER>.*</F-REFERRER>" "<F-USERAGENT>.*</F-USERAGENT>" <F-NUMBEROFREQUESTS>\d+</F-NUMBEROFREQUESTS> "<F-ROUTERNAME>.*</F-ROUTERNAME>" "<F-SERVERURL>.*</F-SERVERURL>" <F-DURATION>.*ms</F-DURATION>$

# ignore common errors like missing media files or JS/CSS/TXT/ICO stuff for traefik CLM access logs
#ignoreregex = ^<HOST> - <F-CLIENTUSERNAME>.*</F-CLIENTUSERNAME> \[<F-TIMESTAMP>.*</F-TIMESTAMP>\] "<F-METHOD>.*</F-METHOD> <F-PATH>.*(\.png|\.txt|\.jpg|\.ico|\.js|\.css)(/)*?</F-PATH> <F-PROTOCOL>.*</F-PROTOCOL>" <F-ORIGINHTTPSTATUS>(405|404|403|401|\-)</F-ORIGINHTTPSTATUS> <F-ORIGINCONTENTSIZE>\d+</F-ORIGINCONTENTSIZE> "<F-REFERRER>.*</F-REFERRER>" "<F-USERAGENT>.*</F-USERAGENT>" <F-NUMBEROFREQUESTS>\d+</F-NUMBEROFREQUESTS> "<F-ROUTERNAME>.*</F-ROUTERNAME>" "<F-SERVERURL>.*</F-SERVERURL>" <F-DURATION>.*ms</F-DURATION>$
